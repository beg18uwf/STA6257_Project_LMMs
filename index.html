<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nick Freeland, Bernice Green, Gary Marmon">
<meta name="dcterms.date" content="2022-11-29">

<title>Linear Mixed Effect Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#analysis-and-results" id="toc-analysis-and-results" class="nav-link" data-scroll-target="#analysis-and-results">Analysis and Results</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a></li>
  <li><a href="#statistical-modeling" id="toc-statistical-modeling" class="nav-link" data-scroll-target="#statistical-modeling">Statistical Modeling</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  <li><a href="#sec-references" id="toc-sec-references" class="nav-link" data-scroll-target="#sec-references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Linear Mixed Effect Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nick Freeland, Bernice Green, Gary Marmon </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 29, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<p><a href="https://beg18uwf.github.io/STA6257_Project_LMMs/Slides">Link to presentation</a></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<!-- #### What are LMMs?  -->
<!-- Include Key vocabulary -->
<p>One of the assumptions of a linear regression model is that all of the observations are independent of each other. Linear Mixed-Effects Models can be used to model correlated data <span class="citation" data-cites="galecki2013">(<a href="#ref-galecki2013" role="doc-biblioref">Gałecki and Burzykowski 2013</a>)</span> which can take the form of cross sectional or longitudinal data. Cross sectional data feature individuals at level 1, nested in a geographical or social context, at level 2. While longitudinal data feature individuals, at level 2, measured over several occasions, at level 1 <span class="citation" data-cites="bell2019fixed">(<a href="#ref-bell2019fixed" role="doc-biblioref">Bell, Fairbrother, and Jones 2019</a>)</span>. It is important to note that data can be nested in more than two levels based on the design and complexity of the study. For example, individuals may be grouped by region and measured over time. There would be three levels to this study.</p>
<p>Mixed-effects models are called “mixed” because they simultaneously model fixed and random effects. These effects account for the differing relationships between and within clusters<span class="citation" data-cites="bell2019fixed">(<a href="#ref-bell2019fixed" role="doc-biblioref">Bell, Fairbrother, and Jones 2019</a>)</span>. Fixed effects model average trends, while random effects model the extent to which these trends vary across levels of some grouping factor <span class="citation" data-cites="brown2021introduction">(<a href="#ref-brown2021introduction" role="doc-biblioref">Brown 2021</a>)</span>. Deciding whether an effect is fixed or random can be a challenge. When the number of clusters is small but the number of observations per cluster is large, we can model that parameter as a fixed effect. Conversely, random effects may have a large number of clusters but a relatively small number of observations per cluster <span class="citation" data-cites="demidenko2013">(<a href="#ref-demidenko2013" role="doc-biblioref">Demidenko 2013</a>)</span>. It is important to include the random effects in the model as fixed effects only give a partial picture of the hierarchical data as they do not reveal information about level 2 entities. Valuable information is lost about the relationship between the clusters <span class="citation" data-cites="bell2019fixed">(<a href="#ref-bell2019fixed" role="doc-biblioref">Bell, Fairbrother, and Jones 2019</a>)</span>.</p>
<p><span class="citation" data-cites="demidenko2013">Demidenko (<a href="#ref-demidenko2013" role="doc-biblioref">2013</a>)</span> notes that in the classical approach, all observations are assumed to be independent and identically distributed, but this assumption can lead to false results for clustered data. Observations between clusters are assumed independent but observations between cluster are dependent as they belong to the same sub population. Mixed Effects Models can be seen as a combination of ANOVA, a fixed effects model, and VARCOMP, a random effects model.</p>
<!-- #### Why do we want to use LMMs? How are they beneficial? Fields used? Where are they most effectively applied? -->
<p>Until more recently, the only way to handle the type of data mixed-effects model does was through repeated measures ANOVAs. Mixed-effects models are much more versatile in handling variability within and across groups and can handle missing data, providing much better results than the ANOVAs. <span class="citation" data-cites="brown2021introduction">(<a href="#ref-brown2021introduction" role="doc-biblioref">Brown 2021</a>)</span></p>
<p><span class="citation" data-cites="brown2021introduction">Brown (<a href="#ref-brown2021introduction" role="doc-biblioref">2021</a>)</span> gives a theoretical account of implementing mixed-effects models, and their commonalities and differences with ANOVA. They show that ANOVA cannot simultaneously take multiple sources of variation into account when observations are nested across participants, which lowers the ability to detect an effect. Mixed-effects modeling allows a researcher to examine the condition of interest while also considering variability within and across participants and items simultaneously and is a reasonable choice when ANOVA and multiple regression are not.</p>
<p>While linear mixed models are most effective for clustered data with a hierarchical structure or repeated measures, they are also well-suited for time-series data, biological/medical data, and modeling shapes/images <span class="citation" data-cites="demidenko2013">(<a href="#ref-demidenko2013" role="doc-biblioref">Demidenko 2013</a>)</span>. The main application for mixed-effect models is in psychology due to the nature of their data and repeated observations across trial participants. However, the applications can extend into almost any field where the variability across a group/person is wanted in the analysis. One such example is the use of mixed-effects models on published health data sets to explore the link between smoking and depression in which it was found smoking status was associated with depression at almost 2 times the risk of non-smoking participants <span class="citation" data-cites="luger2014robust">(<a href="#ref-luger2014robust" role="doc-biblioref">Luger, Suls, and Vander Weg 2014</a>)</span>.</p>
<!-- #### What are the limitations? -->
<p>The critical slope of mixed-effects models is often discussed in literature, finding failure to include the critical slope in the test of an interaction can yield very high Type I error rates <span class="citation" data-cites="barr2013random">(<a href="#ref-barr2013random" role="doc-biblioref">Barr 2013</a>)</span>. “When testing interactions in mixed designs with replications, it is critical to include the random slope corresponding to the highest-order combination of within-subject factors subsumed by each interaction of interest” <span class="citation" data-cites="barr2013random">(<a href="#ref-barr2013random" role="doc-biblioref">Barr 2013</a>)</span>.</p>
<!-- #### How does this apply to our project/data set? -->
<p>After doing an extensive review of current literature, our group aims to gain an understanding of Linear Mixed-Effect Models in order to create our own models and better our understanding. To do so we will use NFL play-by-play data from the nflverse package available in R. In our case we wish to find association between a NFL coach and play performance on the field using the nflverse data set, where the coaches are the random effects.</p>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<!-- #### What are the assumptions of this model? -->
<p>The complex nature of mixed-effects models call into question the robustness of these models and brings more focus to the model assumptions. “Mixed-effects models involve complex fitting procedures and make several assumptions, in particular about the distribution of residual and random effects. Violations of these assumptions are common in real data sets, yet it is not always clear how much these violations matter to accurate and unbiased estimation” <span class="citation" data-cites="schielzeth2020robustness">(<a href="#ref-schielzeth2020robustness" role="doc-biblioref">Schielzeth et al. 2020</a>)</span>. They go on to discuss the consequences of violations of these assumptions and the impact of missing random effect components on model estimates. The study found mixed-effects models to be very robust to violations of these assumptions, finding the estimates were unbiased (although imprecise) and missing random effect predictors had little effect on the fixed effect estimates but had systematic effects on the estimates of random effects <span class="citation" data-cites="schielzeth2020robustness">(<a href="#ref-schielzeth2020robustness" role="doc-biblioref">Schielzeth et al. 2020</a>)</span>.</p>
<p>Many technical papers have delved into the formulation and implementation of linear mixed-effects models, many following the lead of Bates et al.&nbsp;paper, “Fitting linear mixed-effects models using lme4” (2014). <span class="citation" data-cites="bates2014fitting">Bates et al. (<a href="#ref-bates2014fitting" role="doc-biblioref">2014</a>)</span> outlines the creation and implementation of the lme4 package as an extension of lmer function, which has become the predominant tool in the R language for fitting linear mixed-effect models. As for most model-fitting functions in R, the model is described in an lmer call by a formula, in this case including both fixed- and random-effects terms <span class="citation" data-cites="bates2014fitting">(<a href="#ref-bates2014fitting" role="doc-biblioref">Bates et al. 2014</a>)</span>. The paper describes the structure of the model, the steps in evaluating the profiled deviance or REML criterion, and the structure of classes or types that represents such a model <span class="citation" data-cites="bates2014fitting">(<a href="#ref-bates2014fitting" role="doc-biblioref">Bates et al. 2014</a>)</span>. One of the more controversial design decisions of lme4 has been to omit the output of p values (these can be found using parametric bootstrapping functionality). “While the null distributions (and the sampling distributions of non-null estimates) are asymptotically normal, these distributions are not t distributed for finite size samples — nor are the corresponding null distributions of differences in scaled deviances F distributed.” <span class="citation" data-cites="bates2014fitting">(<a href="#ref-bates2014fitting" role="doc-biblioref">Bates et al. 2014</a>)</span>. A common problem in mixed-model inference is the lack of analytical results for parameter estimates in complex situations including unbalanced or crossed designs. <span class="citation" data-cites="bates2014fitting">(<a href="#ref-bates2014fitting" role="doc-biblioref">Bates et al. 2014</a>)</span> <span class="math inline">\(W_n(x)\)</span> is the sum of weights that belongs to all real numbers. Weights are positive numbers and small if <span class="math inline">\(X_i\)</span> is far from <span class="math inline">\(x\)</span>.</p>
<!-- #### What is the formula for this model?  -->
<p>Just as a linear model is described by the distribution of a vector-valued random response variable, Y, whose observed value is <span class="math inline">\(y_{obs}\)</span>, a linear mixed model is described by the distribution of two vector-valued random variables: <span class="math inline">\(Y\)</span>, the response, and <span class="math inline">\(\beta\)</span>, the vector of random effects. In a linear model the distribution of Y is multivariate normal,</p>
<p><span class="math display">\[
Y ∼ N(Xβ + o, σ^2 W^{-1})
\]</span></p>
<p>Our basic model: <span class="math display">\[epa = plays +  (1+plays|coach)\]</span></p>
</section>
<section id="analysis-and-results" class="level2">
<h2 class="anchored" data-anchor-id="analysis-and-results">Analysis and Results</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Our data featured a play by play analysis for every game in the 2021 season. We are attempting to model the coaches effect using the EPA. We first decided to aggregate the data by game and team. We are assuming that all plays are rush or pass and will be using the pass percentage (pass_pct) to model the two different play options per game. After summarizing, we end up with the following table.</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pbp.posteam</td>
<td style="text-align: left;">the team with possession of the ball (offense)</td>
</tr>
<tr class="even">
<td style="text-align: left;">pbp.posteam_type</td>
<td style="text-align: left;">specifies if the possessing team is home or away</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pbp.game_id</td>
<td style="text-align: left;">the specific game id from the NFL</td>
</tr>
<tr class="even">
<td style="text-align: left;">week</td>
<td style="text-align: left;">week number in the season that the game was played</td>
</tr>
<tr class="odd">
<td style="text-align: left;">season_type</td>
<td style="text-align: left;">flag that specifies if it is a regular (0) or post (1) season game</td>
</tr>
<tr class="even">
<td style="text-align: left;">home_adv</td>
<td style="text-align: left;">flag that specifies home (0) or away(1)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">coach</td>
<td style="text-align: left;">the coach of the team with possession (offensive plays)</td>
</tr>
<tr class="even">
<td style="text-align: left;">opp_coach</td>
<td style="text-align: left;">the coach of the opposing team (defensive plays)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">plays</td>
<td style="text-align: left;">total number of rush and pass plays given the team and game</td>
</tr>
<tr class="even">
<td style="text-align: left;">pass_plays</td>
<td style="text-align: left;">number of pass plays given the team and game</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pass_pct</td>
<td style="text-align: left;">the percentage of pass plays in the game calculated by pass_plays/plays</td>
</tr>
<tr class="even">
<td style="text-align: left;">yards_gained</td>
<td style="text-align: left;">yards gained by an offense</td>
</tr>
<tr class="odd">
<td style="text-align: left;">shotgun_snaps</td>
<td style="text-align: left;">number of snaps a team lined up in a shotgun formation</td>
</tr>
<tr class="even">
<td style="text-align: left;">ho_huddle_snaps</td>
<td style="text-align: left;">number of snaps a team used a no huddle offense</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EPA_per_play</td>
<td style="text-align: left;">the mean of all pass and rush plays given team and game</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading packages </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nflverse)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nflplotR)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GLMsData)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>NFL offense summaries from the 2021 season including coach and home/away splits.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading play by play data from the 2021 NFL season</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pbp <span class="ot">&lt;-</span> nflreadr<span class="sc">::</span><span class="fu">load_pbp</span>(<span class="dv">2021</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># team summaries </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>team_sum1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pbp<span class="sc">$</span>game_id, pbp<span class="sc">$</span>home_coach, pbp<span class="sc">$</span>away_coach, pbp<span class="sc">$</span>posteam, pbp<span class="sc">$</span>posteam_type, pbp<span class="sc">$</span>pass, pbp<span class="sc">$</span>rush, pbp<span class="sc">$</span>epa, pbp<span class="sc">$</span>down, pbp<span class="sc">$</span>week, pbp<span class="sc">$</span>season_type, pbp<span class="sc">$</span>yards_gained, pbp<span class="sc">$</span>shotgun, pbp<span class="sc">$</span>no_huddle, pbp<span class="sc">$</span>yards_after_catch)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>team_sum2 <span class="ot">&lt;-</span> team_sum1 <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pbp.rush <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> pbp.pass <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">!</span><span class="fu">is.na</span>(pbp.down)) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> (pbp.posteam, pbp.posteam_type, pbp.game_id) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coach =</span> <span class="fu">ifelse</span>(pbp.posteam_type <span class="sc">==</span> <span class="st">'home'</span>,pbp.home_coach,pbp.away_coach)) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">opp_coach =</span> <span class="fu">ifelse</span>(pbp.posteam_type <span class="sc">==</span> <span class="st">'away'</span>,pbp.home_coach,pbp.away_coach)) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">home_adv =</span> <span class="fu">ifelse</span>(pbp.posteam_type <span class="sc">==</span> <span class="st">'home'</span>, <span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">week =</span> <span class="fu">first</span>(pbp.week),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">season_type =</span> <span class="fu">first</span>(<span class="fu">ifelse</span>(pbp.season_type <span class="sc">==</span> <span class="st">'REG'</span>, <span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_adv =</span> <span class="fu">first</span>(home_adv),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">coach =</span> <span class="fu">first</span>(coach),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">opp_coach =</span> <span class="fu">first</span>(opp_coach),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">plays =</span> <span class="fu">n</span>(),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">pass_plays =</span> <span class="fu">sum</span>(pbp.pass),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">pass_pct =</span> pass_plays <span class="sc">/</span> plays,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">yards_gained =</span> <span class="fu">sum</span>(pbp.yards_gained),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">shotgun_snaps =</span> <span class="fu">sum</span>(pbp.shotgun),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">no_huddle_snap =</span> <span class="fu">sum</span>(pbp.no_huddle),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">epa_per_play =</span> <span class="fu">round</span>(<span class="fu">mean</span>(pbp.epa), <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is the summary of the variables we are choosing to model coach effectiveness.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#generate a summary of each of the features of our data set</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#replace this section with histograms (or other viz) for numerical data</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(team_sum2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> pbp.posteam        pbp.posteam_type   pbp.game_id             week       
 Length:570         Length:570         Length:570         Min.   : 1.000  
 Class :character   Class :character   Class :character   1st Qu.: 5.000  
 Mode  :character   Mode  :character   Mode  :character   Median :10.000  
                                                          Mean   : 9.958  
                                                          3rd Qu.:15.000  
                                                          Max.   :22.000  
                                                                          
  season_type         home_adv      coach            opp_coach        
 Min.   :0.00000   Min.   :0.0   Length:570         Length:570        
 1st Qu.:0.00000   1st Qu.:0.0   Class :character   Class :character  
 Median :0.00000   Median :0.5   Mode  :character   Mode  :character  
 Mean   :0.04561   Mean   :0.5                                        
 3rd Qu.:0.00000   3rd Qu.:1.0                                        
 Max.   :1.00000   Max.   :1.0                                        
                                                                      
     plays         pass_plays       pass_pct       yards_gained  
 Min.   :42.00   Min.   : 3.00   Min.   :0.0625   Min.   : 47.0  
 1st Qu.:59.00   1st Qu.:34.00   1st Qu.:0.5538   1st Qu.:290.0  
 Median :65.00   Median :40.00   Median :0.6299   Median :348.0  
 Mean   :65.17   Mean   :40.44   Mean   :0.6194   Mean   :344.1  
 3rd Qu.:71.00   3rd Qu.:46.00   3rd Qu.:0.6971   3rd Qu.:399.0  
 Max.   :99.00   Max.   :71.00   Max.   :0.9138   Max.   :571.0  
                                                  NA's   :34     
 shotgun_snaps   no_huddle_snap    epa_per_play      
 Min.   : 3.00   Min.   : 0.000   Min.   :-0.840000  
 1st Qu.:34.00   1st Qu.: 2.000   1st Qu.:-0.120000  
 Median :42.00   Median : 5.000   Median : 0.020000  
 Mean   :43.38   Mean   : 7.047   Mean   : 0.007772  
 3rd Qu.:52.00   3rd Qu.:10.000   3rd Qu.: 0.140000  
 Max.   :91.00   Max.   :50.000   Max.   : 0.720000  
                                                     </code></pre>
</div>
</div>
</section>
<section id="visualization" class="level3">
<h3 class="anchored" data-anchor-id="visualization">Visualization</h3>
<p>Our first graph shows that there is a difference in EPA per play for each team. Our model will attempt to find the coaches effect on these differences.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plotting offensive vs defensive EPA per play</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>offense <span class="ot">&lt;-</span> pbp <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="at">team =</span> posteam) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">off_epa =</span> <span class="fu">mean</span>(epa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>defense <span class="ot">&lt;-</span> pbp <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="at">team =</span> defteam) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">def_epa =</span> <span class="fu">mean</span>(epa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>offense <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(defense, <span class="at">by =</span> <span class="st">"team"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> off_epa, <span class="at">y =</span> def_epa)) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">intercept =</span> <span class="fu">c</span>(.<span class="dv">4</span>, .<span class="dv">3</span>, .<span class="dv">2</span>, .<span class="dv">1</span>, <span class="dv">0</span>, <span class="sc">-</span>.<span class="dv">1</span>, <span class="sc">-</span>.<span class="dv">2</span>, <span class="sc">-</span>.<span class="dv">3</span>), <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  nflplotR<span class="sc">::</span><span class="fu">geom_mean_lines</span>(<span class="fu">aes</span>(<span class="at">h_var =</span> off_epa, <span class="at">v_var =</span> def_epa)) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  nflplotR<span class="sc">::</span><span class="fu">geom_nfl_logos</span>(<span class="fu">aes</span>(<span class="at">team_abbr =</span> team), <span class="at">width =</span> <span class="fl">0.07</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Offense EPA/play"</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Defense EPA/play"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"2021 NFL Offensive and Defensive EPA per Play"</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_reverse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The second set of plots shows us the EPA by coach. We can see that there is a difference in expected points per play based on the coach.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare EPA by coach</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(team_sum2, <span class="fu">aes</span>(epa_per_play)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> coach) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This third set of plots models each of our features against our EPA to see if any patterns exist.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot each variable against epa to see if any patterns exist </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(team_sum2, <span class="fu">aes</span>(<span class="at">x=</span>pass_pct, <span class="at">y=</span>epa_per_play)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(team_sum2,<span class="fu">aes</span>(<span class="at">x=</span>week, <span class="at">y=</span>epa_per_play)) <span class="sc">+</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(team_sum2, <span class="fu">aes</span>(<span class="at">x=</span>plays, <span class="at">y=</span>epa_per_play)) <span class="sc">+</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> team_sum2 <span class="sc">|&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>epa_per_play, <span class="at">x=</span>yards_gained)) <span class="sc">+</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> team_sum2 <span class="sc">|&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>epa_per_play, <span class="at">x=</span>shotgun_snaps)) <span class="sc">+</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> team_sum2 <span class="sc">|&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>epa_per_play, <span class="at">x=</span>no_huddle_snap)) <span class="sc">+</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>team_sum2<span class="sc">$</span>season_type <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(team_sum2<span class="sc">$</span>season_type)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>team_sum2<span class="sc">$</span>home_adv <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(team_sum2<span class="sc">$</span>home_adv)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(team_sum2,<span class="fu">aes</span>(<span class="at">x=</span>season_type, <span class="at">y=</span>epa_per_play)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(team_sum2, <span class="fu">aes</span>(home_adv, epa_per_play)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange visualizations in a grid</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, p5, p6, p7, p8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="statistical-modeling" class="level3">
<h3 class="anchored" data-anchor-id="statistical-modeling">Statistical Modeling</h3>
<p>We begin modeling by testing our assumptions using a linear model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create linear model to test assumptions</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>epa.lm <span class="ot">=</span> <span class="fu">lm</span>(epa_per_play <span class="sc">~</span> pass_pct <span class="sc">+</span> plays <span class="sc">+</span> yards_gained <span class="sc">+</span> shotgun_snaps <span class="sc">+</span> no_huddle_snap, <span class="at">data=</span>team_sum2)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(epa.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = epa_per_play ~ pass_pct + plays + yards_gained + 
    shotgun_snaps + no_huddle_snap, data = team_sum2)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.47720 -0.07899  0.00753  0.08871  0.35041 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    -6.873e-02  5.403e-02  -1.272    0.204    
pass_pct       -3.627e-01  5.907e-02  -6.139 1.63e-09 ***
plays          -6.159e-03  8.583e-04  -7.176 2.44e-12 ***
yards_gained    2.024e-03  7.539e-05  26.842  &lt; 2e-16 ***
shotgun_snaps   4.161e-04  6.035e-04   0.689    0.491    
no_huddle_snap -2.163e-03  8.125e-04  -2.662    0.008 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1254 on 530 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.6302,    Adjusted R-squared:  0.6267 
F-statistic: 180.7 on 5 and 530 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We found that the number of shotgun snaps an offense runs does not appear to significantly effect EPA per play. This model explains approximately 63% of the variance in EPA per play.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(epa.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>While there are a few outliers present, we concluded that the overall fit for the selected variables is acceptable. We now want to account for a team’s coach and if a team has home field advantage as random effects.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LMM - random intercepts</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>epa.lmer1 <span class="ot">=</span> <span class="fu">lmer</span>(epa_per_play <span class="sc">~</span> pass_pct <span class="sc">+</span> plays <span class="sc">+</span> yards_gained <span class="sc">+</span> no_huddle_snap <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>home_adv), <span class="at">data=</span>team_sum2)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>epa.lmer1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerModLmerTest']
Formula: epa_per_play ~ pass_pct + plays + yards_gained + no_huddle_snap +  
    (1 | coach) + (1 | home_adv)
   Data: team_sum2
REML criterion at convergence: -657.5259
Random effects:
 Groups   Name        Std.Dev.
 coach    (Intercept) 0.02138 
 home_adv (Intercept) 0.00000 
 Residual             0.12358 
Number of obs: 536, groups:  coach, 34; home_adv, 2
Fixed Effects:
   (Intercept)        pass_pct           plays    yards_gained  no_huddle_snap  
     -0.065738       -0.360035       -0.005792        0.001993       -0.002185  
optimizer (nloptwrap) convergence code: 0 (OK) ; 0 optimizer warnings; 1 lme4 warnings </code></pre>
</div>
</div>
<p>The home advantage random effect approaches zero, so we conclude there is no additional change in EPA per play due to home field advantage itself. However, we observe an additional 0.02 EPA per play due to coaching</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(epa.lmer1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$coach
                (Intercept)   pass_pct        plays yards_gained no_huddle_snap
Andy Reid       -0.04320522 -0.3600351 -0.005791862  0.001992788   -0.002184533
Arthur Smith    -0.07545211 -0.3600351 -0.005791862  0.001992788   -0.002184533
Bill Belichick  -0.06125237 -0.3600351 -0.005791862  0.001992788   -0.002184533
Brandon Staley  -0.05998892 -0.3600351 -0.005791862  0.001992788   -0.002184533
Brian Flores    -0.04802109 -0.3600351 -0.005791862  0.001992788   -0.002184533
Bruce Arians    -0.04782538 -0.3600351 -0.005791862  0.001992788   -0.002184533
Dan Campbell    -0.07769279 -0.3600351 -0.005791862  0.001992788   -0.002184533
Darrell Bevell  -0.06463750 -0.3600351 -0.005791862  0.001992788   -0.002184533
David Culley    -0.08170016 -0.3600351 -0.005791862  0.001992788   -0.002184533
Frank Reich     -0.06182493 -0.3600351 -0.005791862  0.001992788   -0.002184533
Joe Judge       -0.06773172 -0.3600351 -0.005791862  0.001992788   -0.002184533
John Harbaugh   -0.07460723 -0.3600351 -0.005791862  0.001992788   -0.002184533
Jon Gruden      -0.07307754 -0.3600351 -0.005791862  0.001992788   -0.002184533
Kevin Stefanski -0.06918734 -0.3600351 -0.005791862  0.001992788   -0.002184533
Kliff Kingsbury -0.05564862 -0.3600351 -0.005791862  0.001992788   -0.002184533
Kyle Shanahan   -0.08706086 -0.3600351 -0.005791862  0.001992788   -0.002184533
Matt LaFleur    -0.04161529 -0.3600351 -0.005791862  0.001992788   -0.002184533
Matt Nagy       -0.07627911 -0.3600351 -0.005791862  0.001992788   -0.002184533
Matt Rhule      -0.07697774 -0.3600351 -0.005791862  0.001992788   -0.002184533
Mike McCarthy   -0.06800655 -0.3600351 -0.005791862  0.001992788   -0.002184533
Mike Tomlin     -0.05067471 -0.3600351 -0.005791862  0.001992788   -0.002184533
Mike Vrabel     -0.06455181 -0.3600351 -0.005791862  0.001992788   -0.002184533
Mike Zimmer     -0.07799479 -0.3600351 -0.005791862  0.001992788   -0.002184533
Nick Sirianni   -0.06563687 -0.3600351 -0.005791862  0.001992788   -0.002184533
Pete Carroll    -0.05485163 -0.3600351 -0.005791862  0.001992788   -0.002184533
Rich Bisaccia   -0.07533029 -0.3600351 -0.005791862  0.001992788   -0.002184533
Robert Saleh    -0.07004850 -0.3600351 -0.005791862  0.001992788   -0.002184533
Ron Rivera      -0.07123896 -0.3600351 -0.005791862  0.001992788   -0.002184533
Sean McDermott  -0.04492282 -0.3600351 -0.005791862  0.001992788   -0.002184533
Sean McVay      -0.06487735 -0.3600351 -0.005791862  0.001992788   -0.002184533
Sean Payton     -0.08293789 -0.3600351 -0.005791862  0.001992788   -0.002184533
Urban Meyer     -0.06971178 -0.3600351 -0.005791862  0.001992788   -0.002184533
Vic Fangio      -0.06030615 -0.3600351 -0.005791862  0.001992788   -0.002184533
Zac Taylor      -0.07022429 -0.3600351 -0.005791862  0.001992788   -0.002184533

$home_adv
  (Intercept)   pass_pct        plays yards_gained no_huddle_snap
0 -0.06573825 -0.3600351 -0.005791862  0.001992788   -0.002184533
1 -0.06573825 -0.3600351 -0.005791862  0.001992788   -0.002184533

attr(,"class")
[1] "coef.mer"</code></pre>
</div>
</div>
<p>Each coach is assigned a different intercept, but the fixed effects are the same for all coaches. This model is called a Random Intercept model; we are accounting for baseline differences in EPA per play. Alternatively, in a Random Slope model, each coach is allowed to have a different intercept, as well as different slopes for the effect of number of plays ran and percentage of pass plays, etc. We implement a Random Slope model below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LMM - random slopes</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>epa.lmer2 <span class="ot">=</span> <span class="fu">lmer</span>(epa_per_play <span class="sc">~</span> pass_pct <span class="sc">+</span> plays <span class="sc">+</span> yards_gained <span class="sc">+</span> shotgun_snaps <span class="sc">+</span> no_huddle_snap <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">+</span>pass_pct<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>plays<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>yards_gained<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>shotgun_snaps<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>no_huddle_snap<span class="sc">|</span>coach), <span class="at">data=</span>team_sum2)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(epa.lmer2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$coach
                 (Intercept)   pass_pct        plays yards_gained shotgun_snaps
Andy Reid        0.006728102 -0.3722720 -0.005903043  0.001981324  1.643708e-04
Arthur Smith    -0.023457725 -0.4163653 -0.005069429  0.002304498 -3.061528e-04
Bill Belichick  -0.140352195 -0.3184948 -0.005569778  0.002082485  2.021416e-03
Brandon Staley  -0.033920695 -0.3747068 -0.005216834  0.001901461  9.572888e-04
Brian Flores     0.002506320 -0.3522986 -0.005979379  0.001797215  5.451766e-04
Bruce Arians     0.052625347 -0.3654553 -0.005339229  0.002170506 -2.141573e-03
Dan Campbell    -0.032633593 -0.4078123 -0.005069111  0.002024292  3.117033e-04
Darrell Bevell  -0.015657333 -0.3896159 -0.004847335  0.002069363  1.089954e-04
David Culley     0.063837649 -0.4540726 -0.005290452  0.002363655 -8.149542e-04
Frank Reich     -0.025375148 -0.3901127 -0.004961856  0.001921123  8.116697e-04
Joe Judge       -0.178672995 -0.3502147 -0.005309498  0.002136269  2.272439e-03
John Harbaugh   -0.085785257 -0.3705963 -0.005485294  0.001687278  2.533594e-04
Jon Gruden      -0.065387302 -0.4016475 -0.006154771  0.001682994 -8.681434e-04
Kevin Stefanski -0.068462398 -0.3889952 -0.005997136  0.001684096  4.496838e-04
Kliff Kingsbury  0.051739732 -0.4048163 -0.004771162  0.002124108  2.616412e-03
Kyle Shanahan   -0.092695066 -0.4018564 -0.004872697  0.001967280 -7.448583e-04
Matt LaFleur     0.009175643 -0.3892986 -0.006130100  0.001926008 -2.117968e-03
Matt Nagy       -0.012257161 -0.4602187 -0.005191404  0.001789964 -2.279178e-04
Matt Rhule      -0.027027035 -0.4215012 -0.005008515  0.002083713  7.042946e-04
Mike McCarthy   -0.050779149 -0.3789256 -0.006218571  0.001894948 -7.706345e-04
Mike Tomlin     -0.000739052 -0.3588243 -0.005649494  0.001647816 -1.357040e-04
Mike Vrabel     -0.092176195 -0.3681597 -0.005167046  0.001774901  8.072048e-04
Mike Zimmer     -0.044902009 -0.4054232 -0.005807989  0.001576495  6.930357e-04
Nick Sirianni    0.026657081 -0.3971460 -0.006063984  0.001597985 -8.912411e-04
Pete Carroll    -0.010958598 -0.3705593 -0.005734104  0.001799123 -8.468388e-04
Rich Bisaccia   -0.087976366 -0.3991398 -0.005000101  0.001939447  1.351791e-03
Robert Saleh    -0.060129840 -0.3864619 -0.006329958  0.001930776 -4.410997e-04
Ron Rivera      -0.014025074 -0.4086765 -0.005228427  0.002043236 -7.844644e-05
Sean McDermott  -0.014575366 -0.3530997 -0.006428880  0.002164647  1.196181e-03
Sean McVay      -0.080704890 -0.3672137 -0.006432359  0.001839938  1.301721e-04
Sean Payton      0.017636375 -0.4697251 -0.004587776  0.002273799 -1.316270e-03
Urban Meyer     -0.098298356 -0.3945568 -0.006070095  0.001652765 -3.788461e-04
Vic Fangio      -0.054760804 -0.3936710 -0.005953839  0.001849059 -1.336985e-03
Zac Taylor      -0.001455182 -0.4349757 -0.005740040  0.001874798 -2.737028e-03
                no_huddle_snap
Andy Reid        -0.0058093563
Arthur Smith     -0.0058624367
Bill Belichick   -0.0048304130
Brandon Staley   -0.0044107145
Brian Flores     -0.0010453179
Bruce Arians      0.0001820800
Dan Campbell     -0.0010163447
Darrell Bevell   -0.0032434967
David Culley     -0.0036796230
Frank Reich      -0.0045399996
Joe Judge         0.0009341072
John Harbaugh     0.0004770374
Jon Gruden       -0.0023511710
Kevin Stefanski  -0.0028770576
Kliff Kingsbury  -0.0035707260
Kyle Shanahan     0.0008943490
Matt LaFleur     -0.0067799681
Matt Nagy        -0.0071003834
Matt Rhule       -0.0034785858
Mike McCarthy    -0.0006280615
Mike Tomlin      -0.0038637422
Mike Vrabel      -0.0070569422
Mike Zimmer      -0.0022987409
Nick Sirianni    -0.0011921270
Pete Carroll     -0.0022896070
Rich Bisaccia    -0.0034292690
Robert Saleh     -0.0005199952
Ron Rivera       -0.0023886547
Sean McDermott   -0.0067992828
Sean McVay       -0.0042224858
Sean Payton      -0.0028031571
Urban Meyer      -0.0032220211
Vic Fangio       -0.0039772236
Zac Taylor       -0.0023049594

attr(,"class")
[1] "coef.mer"</code></pre>
</div>
</div>
<p>This model expects different baseline levels of plays ran and pass_pct. Despite the individual variation of pass_pct, all the values are negative and very close to each other. We see consistency with how often coaches throw the ball. The variation in number of shotgun snaps an offense runs is much wider.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing for significance between models with and without home field advantage</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>epa.lmer2.null <span class="ot">=</span> <span class="fu">lmer</span>(epa_per_play <span class="sc">~</span> pass_pct <span class="sc">+</span> plays <span class="sc">+</span> yards_gained <span class="sc">+</span> shotgun_snaps <span class="sc">+</span> no_huddle_snap <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span><span class="sc">+</span>pass_pct<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>plays<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>yards_gained<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>shotgun_snaps<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>no_huddle_snap<span class="sc">|</span>coach),                                            <span class="at">data=</span>team_sum2,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">REML=</span><span class="cn">FALSE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>epa.lmer2.full <span class="ot">=</span> <span class="fu">lmer</span>(epa_per_play <span class="sc">~</span> home_adv <span class="sc">+</span> pass_pct <span class="sc">+</span> plays <span class="sc">+</span> yards_gained <span class="sc">+</span> shotgun_snaps <span class="sc">+</span> no_huddle_snap <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span><span class="sc">+</span>home_adv<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>pass_pct<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>plays<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>yards_gained<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>shotgun_snaps<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>no_huddle_snap<span class="sc">|</span>coach),                       <span class="at">data=</span>team_sum2,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">REML=</span><span class="cn">FALSE</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(epa.lmer2.full, epa.lmer2.null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data: team_sum2
Models:
epa.lmer2.null: epa_per_play ~ pass_pct + plays + yards_gained + shotgun_snaps + no_huddle_snap + (1 + pass_pct | coach) + (1 + plays | coach) + (1 + yards_gained | coach) + (1 + shotgun_snaps | coach) + (1 + no_huddle_snap | coach)
epa.lmer2.full: epa_per_play ~ home_adv + pass_pct + plays + yards_gained + shotgun_snaps + no_huddle_snap + (1 + home_adv | coach) + (1 + pass_pct | coach) + (1 + plays | coach) + (1 + yards_gained | coach) + (1 + shotgun_snaps | coach) + (1 + no_huddle_snap | coach)
               npar     AIC     BIC logLik deviance  Chisq Df Pr(&gt;Chisq)
epa.lmer2.null   22 -668.99 -574.74 356.50  -712.99                     
epa.lmer2.full   26 -663.43 -552.04 357.72  -715.43 2.4394  4     0.6555</code></pre>
</div>
</div>
<p>We observe no statistical significance between the models and conclude the effect of home field advantage is minimal to zero.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>team_sum2f <span class="ot">&lt;-</span> team_sum2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(season_type<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>epa.lmer2f <span class="ot">=</span> <span class="fu">lmer</span>(epa_per_play <span class="sc">~</span> pass_pct <span class="sc">+</span> plays <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">+</span>pass_pct<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>plays<span class="sc">|</span>coach), <span class="at">data=</span>team_sum2f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>intercepts2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">coef</span>(epa.lmer2f)<span class="sc">$</span>coach[,<span class="dv">1</span>], <span class="at">each =</span> <span class="dv">16</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>slopes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">coef</span>(epa.lmer2f)<span class="sc">$</span>coach[,<span class="dv">2</span>], <span class="at">each =</span> <span class="dv">16</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>model_intercept <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">fixef</span>(epa.lmer2f)[<span class="dv">1</span>])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>model_slope <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">fixef</span>(epa.lmer2f)[<span class="dv">2</span>])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(team_sum2f, <span class="fu">aes</span>(<span class="at">x =</span> pass_pct, <span class="at">y =</span> epa_per_play, <span class="at">color=</span>coach)) <span class="sc">+</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> model_slope, <span class="at">intercept =</span> model_intercept, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">slope =</span> slopes, </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">intercept =</span> intercepts2, <span class="at">linetype =</span> coach, <span class="at">color =</span> coach), </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),         </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>, </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Pass Percent"</span>, <span class="at">y =</span> <span class="st">"Epa Per Play"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>slopes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">coef</span>(epa.lmer2f)<span class="sc">$</span>coach[,<span class="dv">3</span>], <span class="at">each =</span> <span class="dv">16</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>model_slope <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">fixef</span>(epa.lmer2f)[<span class="dv">3</span>])</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(team_sum2f, <span class="fu">aes</span>(<span class="at">x =</span> plays, <span class="at">y =</span> epa_per_play, <span class="at">color=</span>coach)) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> model_slope, <span class="at">intercept =</span> model_intercept, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">slope =</span> slopes, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">intercept =</span> intercepts2, <span class="at">linetype =</span> coach, <span class="at">color =</span> coach), </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),         </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>, </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Plays"</span>, <span class="at">y =</span> <span class="st">"Epa Per Play"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>epa.lmer3f <span class="ot">=</span> <span class="fu">lmer</span>(epa_per_play <span class="sc">~</span>  plays <span class="sc">+</span> home_adv <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span><span class="sc">+</span>home_adv<span class="sc">|</span>coach) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>plays<span class="sc">|</span>coach), <span class="at">data=</span>team_sum2f,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">REML=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>intercepts2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">coef</span>(epa.lmer3f)<span class="sc">$</span>coach[,<span class="dv">1</span>], <span class="at">each =</span> <span class="dv">16</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>slopes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">coef</span>(epa.lmer3f)<span class="sc">$</span>coach[,<span class="dv">2</span>], <span class="at">each =</span> <span class="dv">16</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>model_intercept <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">fixef</span>(epa.lmer3f)[<span class="dv">1</span>])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>model_slope <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">fixef</span>(epa.lmer3f)[<span class="dv">2</span>])</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(team_sum2f, <span class="fu">aes</span>(<span class="at">x =</span> plays, <span class="at">y =</span> epa_per_play, <span class="at">color=</span>home_adv)) <span class="sc">+</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> model_slope, <span class="at">intercept =</span> model_intercept, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">slope =</span> slopes, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">intercept =</span> intercepts2, <span class="at">linetype =</span> coach), </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> .<span class="dv">4</span>, <span class="at">color=</span><span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>home_adv), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"grey70"</span>) <span class="sc">+</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> plays, <span class="at">xend =</span> plays, </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> epa_per_play, <span class="at">yend =</span> <span class="fu">fitted</span>(epa.lmer3f)), </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),         </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>, </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">"Plays"</span>, <span class="at">y =</span> <span class="st">"Epa Per Play"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>Using a linear mixed-effects model, we are able to find the additional effect a team’s coach has on the offenses success, measured by EPA per play. After accounting for the fixed effects plays ran, percentage of pass plays, yards gained, shotgun snaps, and no huddle snaps, our random effect coefficient for coaching showed an additional change 0.02 EPA per play due to coaching and no change in EPA per play due to home field advantage.</p>
</section>
</section>
<section id="sec-references" class="level2">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-barr2013random" class="csl-entry" role="doc-biblioentry">
Barr, Dale J. 2013. <span>“Random Effects Structure for Testing Interactions in Linear Mixed-Effects Models.”</span> <em>Frontiers in Psychology</em>. Frontiers Media SA.
</div>
<div id="ref-bates2014fitting" class="csl-entry" role="doc-biblioentry">
Bates, Douglas, Martin Mächler, Ben Bolker, and Steve Walker. 2014. <span>“Fitting Linear Mixed-Effects Models Using Lme4.”</span> <em>arXiv Preprint arXiv:1406.5823</em>.
</div>
<div id="ref-bell2019fixed" class="csl-entry" role="doc-biblioentry">
Bell, Andrew, Malcolm Fairbrother, and Kelvyn Jones. 2019. <span>“Fixed and Random Effects Models: Making an Informed Choice.”</span> <em>Qual Quant</em> 53: 1051–74. <a href="https://doi.org/10.1007/s11135-018-0802-x">https://doi.org/10.1007/s11135-018-0802-x</a>.
</div>
<div id="ref-brown2021introduction" class="csl-entry" role="doc-biblioentry">
Brown, Violet A. 2021. <span>“An Introduction to Linear Mixed-Effects Modeling in r.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 4 (1): 2515245920960351.
</div>
<div id="ref-demidenko2013" class="csl-entry" role="doc-biblioentry">
Demidenko, Eugene. 2013. <em>Mixed Models: Theory and Applications with r</em>. 2nd ed. Hoboken, New Jersey: John Wiley &amp; Sons, Inc.
</div>
<div id="ref-galecki2013" class="csl-entry" role="doc-biblioentry">
Gałecki, Andrzej, and Tomasz Burzykowski. 2013. <em>Linear Mixed-Effects Models Using r: A Step-by-Step Approach</em>. New York, NY: Springer Science+Business Media. <a href="https://doi.org/10.1007/978-1-4614-3900-4
">https://doi.org/10.1007/978-1-4614-3900-4 </a>.
</div>
<div id="ref-luger2014robust" class="csl-entry" role="doc-biblioentry">
Luger, Tana M, Jerry Suls, and Mark W Vander Weg. 2014. <span>“How Robust Is the Association Between Smoking and Depression in Adults? A Meta-Analysis Using Linear Mixed-Effects Models.”</span> <em>Addictive Behaviors</em> 39 (10): 1418–29.
</div>
<div id="ref-schielzeth2020robustness" class="csl-entry" role="doc-biblioentry">
Schielzeth, Holger, Niels J Dingemanse, Shinichi Nakagawa, David F Westneat, Hassen Allegue, Céline Teplitsky, Denis Réale, Ned A Dochtermann, László Zsolt Garamszegi, and Yimen G Araya-Ajoy. 2020. <span>“Robustness of Linear Mixed-Effects Models to Violations of Distributional Assumptions.”</span> <em>Methods in Ecology and Evolution</em> 11 (9): 1141–52.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>